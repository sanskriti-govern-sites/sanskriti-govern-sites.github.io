<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Indian Government Services Portal</title>
  <link href="https://fonts.googleapis.com/css2?family=Tilt+Prism&family=Poppins:wght@300;400;600;700&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- PWA manifest (placeholder icons) -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#064663">

  <style>
    /* ========== ORIGINAL CSS START (kept intact) ========== */
    :root {
      --primary-grad: linear-gradient(90deg, #064663, #0a86b8);
      --glass-bg: rgba(255, 255, 255, 0.95);
      --card-hover: rgba(220, 245, 255, 0.98);
      --accent: #0a86b8;
      --text: #333;
      --font-base: 16px;
    }

    html, body { 
      height: 100%; 
      margin: 0; 
      font-family: 'Inter', 'Poppins', sans-serif; 
      color: var(--text); 
      scroll-behavior: smooth; 
      font-size: var(--font-base);
    }
    
    body { background: #000; overflow-x: hidden; }
    
    /* Vanta Background Layer */
    #vanta-bg { position: fixed; top:0; left:0; width:100vw; height:100vh; z-index:0; }
    
    /* Main Wrapper */
    #content-wrapper { position:relative; z-index:2; min-height:100vh; display:flex; flex-direction:column; }

    /* --- Accessibility Top Bar --- */
    .top-bar {
      background: #022c3f;
      color: #fff;
      padding: 5px 5%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.8em;
      border-bottom: 1px solid #0a4d6b;
    }
    .access-tools { display: flex; align-items: center; }
    .access-tools button {
      background: none;
      border: 1px solid #0a86b8;
      color: #fff;
      padding: 2px 8px;
      margin-left: 5px;
      cursor: pointer;
      border-radius: 4px;
      font-size: 0.9em;
    }
    .access-tools button:hover { background: #0a86b8; }
    
    /* --- Header --- */
    header {
      background: var(--primary-grad);
      color: #fff;
      padding: 1.5em 5%;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      position: relative;
    }
    .header-logo { width: 70px; height: auto; border-radius: 5px; background: rgba(255,255,255,0.1); padding: 5px; }
    .header-center { flex: 1; text-align: center; }
    header h1 { 
      font-family:'Tilt Prism', cursive; 
      font-size: clamp(2em, 4vw, 3em); 
      margin: 0; 
      letter-spacing: 1px; 
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    header p { font-family:'Poppins', sans-serif; font-size: clamp(0.9em, 1.5vw, 1.1em); color:#d1f4ff; margin: 0.5em 0 0; }

    /* --- Main Layout --- */
    .container {
      width: 95%;
      max-width: 1300px;
      margin: 2em auto;
    }

    /* Main Content Area */
    main { width: 100%; }

    /* --- Search & Filters --- */
    .controls-panel {
      background: var(--glass-bg);
      padding: 1.5em;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      margin-bottom: 2em;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .search-wrapper { position: relative; width: 100%; }
    .search-bar input {
      width: 100%;
      padding: 12px 45px 12px 15px;
      border-radius: 8px;
      border: 2px solid #ccc;
      outline: none;
      font-size: 1em;
      box-sizing: border-box;
      transition: 0.3s;
    }
    .search-bar input:focus { border-color: #0a86b8; box-shadow: 0 0 8px rgba(10,134,184,0.3); }
    .voice-btn {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      font-size: 1.2em;
      color: #064663;
      cursor: pointer;
    }
    .voice-btn.listening { color: #d32f2f; animation: pulse 1s infinite; }
    @keyframes pulse { 0% { transform:translateY(-50%) scale(1); } 50% { transform:translateY(-50%) scale(1.2); } 100% { transform:translateY(-50%) scale(1); } }

    /* --- Cards --- */
    .card-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 24px;
      padding-bottom: 2em;
    }
    
    /* List View Override */
    .card-container.list-view { grid-template-columns: 1fr; }
    .card-container.list-view .website-card { 
      flex-direction: row; 
      align-items: center; 
      text-align: left; 
      padding: 1em; 
      min-height: auto; 
    }
    .card-container.list-view .website-placeholder { margin-bottom: 0; margin-right: 1.5em; width: 50px; height: 50px; font-size: 1.2em; }
    .card-container.list-view .more-info { margin-top: 0; margin-left: auto; }
    .card-container.list-view .card-actions { position: static; margin-left: 15px; }

    .website-card {
      background: var(--glass-bg);
      border-radius: 12px;
      padding: 1.5em;
      box-shadow: 0 4px 15px rgba(0,0,0,0.15);
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      min-height: 240px;
      position: relative;
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      border-top: 4px solid transparent;
    }
    .website-card:hover {
      background: var(--card-hover);
      transform: translateY(-5px);
      box-shadow: 0 12px 30px rgba(6,70,99,0.3);
      border-top: 4px solid #0a86b8;
    }

    .card-actions {
      position: absolute;
      top: 10px;
      right: 10px;
      display: flex;
      gap: 5px;
    }
    .icon-btn {
      background: rgba(255,255,255,0.8);
      border: none;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      cursor: pointer;
      color: #888;
      transition: 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .icon-btn:hover { background: #fff; color: #0a86b8; transform: scale(1.1); }
    .icon-btn.liked { color: #e91e63; }

    .website-placeholder {
      width: 64px;
      height: 64px;
      margin-bottom: 1em;
      border-radius: 50%;
      background: #064663;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #fff;
      font-size: 1.6em;
      font-weight: 700;
      border: 3px solid #ace4fd;
      transition: background 0.3s;
    }
    
    .website-title { color: #05445e; font-size: 1.25em; font-weight: bold; margin-bottom: 0.5em; text-decoration: none; }
    .website-title:hover { text-decoration: underline; color: #0a86b8; }
    .website-category { font-size: 0.75em; text-transform: uppercase; color: #666; letter-spacing: 1px; margin-bottom: 0.5em; background: #eee; padding: 2px 8px; border-radius: 4px; }
    
    .website-info { color: #333; font-size: 0.95em; flex-grow: 1; margin-bottom: 1.2em; line-height: 1.5; }
    
    .btn-group { display: flex; gap: 10px; margin-top: auto; }
    .more-info {
      color: #fff;
      background: #064663;
      border: none;
      padding: 0.6em 1.2em;
      font-size: 0.9em;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: background 0.3s;
      text-decoration: none;
      display: inline-block;
    }
    .more-info:hover { background: #0a658e; }
    .share-btn { background: #e0f7fa; color: #064663; }
    .share-btn:hover { background: #b2ebf2; }

    /* --- Footer --- */
    footer { text-align: center; padding: 2em 0; color: #cfeff9; background: #021f2b; margin-top: auto; border-top: 4px solid #0a86b8; }
    .footer-links { margin-bottom: 1em; }
    .footer-links a { color: #8cd6f7; text-decoration: none; margin: 0 10px; transition: 0.2s; }
    .footer-links a:hover { color: #fff; text-decoration: underline; }

    /* Camouflaged Link Style */
    .camouflaged-admin-link {
        color: #0d2838; /* Very dark blue, close to the footer background (#021f2b) */
        font-size: 0.6em;
        text-decoration: none;
        cursor: pointer;
        margin-top: 5px;
        display: inline-block;
        transition: color 0.3s;
    }
    .camouflaged-admin-link:hover {
        color: #385973; /* Slightly lighter on hover to confirm it's interactive */
    }

    /* --- Utilities --- */
    #toTopBtn { position: fixed; bottom: 20px; right: 20px; z-index: 99; background: #0a86b8; color: white; border: none; border-radius: 50%; width: 45px; height: 45px; font-size: 1.5em; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.3); opacity: 0; pointer-events: none; transition: 0.3s; }
    #toTopBtn.show { opacity: 1; pointer-events: auto; }
    
    .toast {
      position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
      background: rgba(0,0,0,0.8); color: white; padding: 10px 20px; border-radius: 20px;
      z-index: 1000; opacity: 0; transition: 0.3s; font-size: 0.9em; pointer-events: none;
    }
    .toast.show { opacity: 1; bottom: 50px; }

    /* High Contrast Mode Override */
    body.high-contrast { background: #000; color: #fff; }
    body.high-contrast #vanta-bg { opacity: 0.1; }
    body.high-contrast .website-card, body.high-contrast .widget, body.high-contrast .controls-panel { 
      background: #111; border: 1px solid #fff; color: #fff; box-shadow: none; 
    }
    body.high-contrast a, body.high-contrast h3, body.high-contrast .website-title { color: #ffff00; }
    body.high-contrast .pill { background: #000; border-color: #fff; color: #fff; }
    body.high-contrast .pill.active { background: #ffff00; color: #000; }
    /* Ensure camouflaged link is still visible in high contrast */
    body.high-contrast .camouflaged-admin-link { color: #555; }


    /* --- ADMIN PANEL STYLES --- */
    #admin-panel {
        background: var(--glass-bg);
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        margin-bottom: 2em;
    }
    #admin-panel h2 {
        color: #064663;
        border-bottom: 3px solid var(--accent);
        padding-bottom: 10px;
        margin-top: 0;
        margin-bottom: 20px;
    }
    #admin-main {
        display: flex;
        gap: 20px;
    }
    #admin-sidebar {
        width: 250px;
        padding-right: 20px;
        border-right: 1px solid #ddd;
    }
    .admin-nav button {
        display: block;
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
        background: #0a86b8;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: background 0.2s;
        font-weight: 600;
        text-align: left;
    }
    .admin-nav button:hover { background: #0a658e; }
    .admin-nav button.active { background: #e91e63; }

    /* Admin Table */
    .admin-table-wrapper { overflow-x: auto; }
    .admin-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }
    .admin-table th, .admin-table td {
        border: 1px solid #ddd;
        padding: 10px;
        text-align: left;
        font-size: 0.9em;
    }
    .admin-table th {
        background-color: #f2f2f2;
        color: #064663;
        font-weight: 700;
    }
    .admin-table tr:nth-child(even) { background-color: #f9f9f9; }
    .admin-table tr:hover { background-color: #e6f7ff; }
    .admin-actions button {
        background: #0a86b8;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 4px;
        cursor: pointer;
        margin-right: 5px;
    }
    .admin-actions .delete-btn { background: #d32f2f; }
    .admin-actions button:hover { opacity: 0.8; }

    /* Admin Form */
    .admin-form label { display: block; margin-top: 10px; font-weight: 600; color: #064663; }
    .admin-form input, .admin-form textarea, .admin-form select {
        width: 100%;
        padding: 10px;
        margin-top: 5px;
        border: 1px solid #ccc;
        border-radius: 6px;
        box-sizing: border-box;
    }
    .admin-form button {
        margin-top: 20px;
        padding: 10px 20px;
        font-size: 1em;
        font-weight: 700;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        background: #4caf50;
        color: white;
        transition: background 0.2s;
    }
    .admin-form button:hover { background: #43a047; }
    
    @media (max-width: 900px) {
      header { flex-direction: column; }
      .header-center { margin: 1em 0; }
      #admin-main { flex-direction: column; }
      #admin-sidebar { width: 100%; padding-right: 0; border-right: none; border-bottom: 1px solid #ddd; padding-bottom: 20px; margin-bottom: 20px; }
      .admin-nav button { text-align: center; }
    }
    /* ========== ORIGINAL CSS END ========== */

    /* ========== SMALL NEW CSS (non-invasive) ========== */
    /* dark mode overrides (keeps original look while flipping background/colors) */
    body.dark-mode {
      background: #0b1220;
      color: #e6f6ff;
    }
    body.dark-mode header { filter: brightness(0.95); }
    body.dark-mode .controls-panel, body.dark-mode .website-card, body.dark-mode #admin-panel {
      background: rgba(10,18,28,0.85);
      color: #e6f6ff;
      border: 1px solid rgba(255,255,255,0.05);
    }
    body.dark-mode .website-title { color: #a7e5ff; }
    body.dark-mode .website-info { color: #cfeefc; }

    .top-controls { display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
    .pill { padding:6px 10px; border-radius:999px; background:#f2f2f2; border:1px solid #ddd; cursor:pointer; font-weight:600; }
    .pill.active { background:#0a86b8; color:#fff; }
    .controls-row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }

    /* small modal styles for admin login */
    .modal-backdrop { position:fixed; inset:0; background:rgba(0,0,0,0.6); z-index:2000; display:flex; align-items:center; justify-content:center; }
    .modal { background:var(--glass-bg); padding:20px; border-radius:8px; max-width:420px; width:92%; box-shadow:0 10px 40px rgba(0,0,0,0.4); }
    .modal h3 { margin-top:0; color:#064663; }
    .hidden { display:none !important; }

    /* admin small toolbar */
    .admin-toolbar { display:flex; gap:10px; align-items:center; margin-bottom:12px; flex-wrap:wrap; }
    .small { font-size:0.85em; padding:6px 10px; border-radius:6px; border:none; cursor:pointer; }

    /* small snackbar for undo */
    .snackbar {
      position: fixed; left: 50%; transform: translateX(-50%); bottom: 24px;
      background: #222; color: #fff; padding: 12px 16px; border-radius: 8px; display:flex; gap:10px; align-items:center; z-index: 3000;
      box-shadow: 0 8px 30px rgba(0,0,0,0.4); opacity:0; pointer-events:none; transition:0.25s;
    }
    .snackbar.show { opacity:1; pointer-events:auto; }

    /* online / offline indicator */
    .status-pill { padding:6px 8px; border-radius:999px; background:#222; color:#fff; font-weight:700; font-size:0.85em; display:inline-block; }
    .status-pill.online { background: #2e7d32; }
    .status-pill.offline { background: #b71c1c; }

    /* tiny responsive tweak for card actions on small width */
    @media (max-width: 420px) {
      .card-actions { top:6px; right:6px; }
      .website-placeholder { width:56px; height:56px; }
    }
  </style>
</head>
<body>

  <!-- Background -->
  <div id="vanta-bg" aria-hidden="true"></div>

  <div id="content-wrapper">
    
    <!-- Top Accessibility Bar (Admin Link Removed) -->
    <div class="top-bar" role="region" aria-label="Top accessibility bar">
      <div id="live-datetime">Loading date...</div>
      <div class="access-tools">
        <div class="top-controls">
          <span id="online-status" class="status-pill offline" aria-live="polite">Offline</span>
          <span id="lang-display">English</span>
          <button class="small" onclick="toggleLang()">Êñá/A</button>
          <button class="small" onclick="resizeFont(-1)">A-</button>
          <button class="small" onclick="resizeFont(0)">A</button>
          <button class="small" onclick="resizeFont(1)">A+</button>
          <button class="small" onclick="toggleContrast()" title="High contrast"><i class="fas fa-adjust"></i></button>
          <button class="small" id="darkToggle" onclick="toggleDark()" title="Toggle dark mode"><i class="fas fa-moon"></i></button>
        </div>
      </div>
    </div>

    <!-- Header -->
    <header>
      <img src="/emblem.png" alt="Indian Emblem" class="header-logo" onerror="this.src='https://upload.wikimedia.org/wikipedia/commons/5/55/Emblem_of_India.svg'">
      <div class="header-center">
        <h1 id="main-heading">Indian Government Websites</h1>
        <p id="sub-heading">Your Gateway to Digital Governance & Public Services</p>
      </div>
      <img src="/logo of my school.png" alt="School Logo" class="header-logo" onerror="this.style.opacity=0">
    </header>

    <!-- Public Portal Content -->
    <div id="public-portal">
      <div class="container">
        
        <!-- Main Content -->
        <main>
          <div class="controls-panel" role="region" aria-label="Search and filters">
            
            <!-- Search + controls -->
            <div class="controls-row">
              <div class="search-bar search-wrapper" style="flex:1 1 380px;">
                <input type="text" id="search" placeholder="üîç Search services, departments..." aria-label="Search" />
                <button class="voice-btn" id="voiceBtn" title="Search by voice" aria-hidden="true"><i class="fas fa-microphone"></i></button>
              </div>

              <div class="controls-row" style="align-items:center;">
                <select id="categoryFilter" aria-label="Filter by category" class="pill" title="Filter by category">
                  <option value="">All Categories</option>
                </select>

                <select id="sortSelect" aria-label="Sort by" class="pill" title="Sort">
                  <option value="name_asc">Name A‚ÜíZ</option>
                  <option value="name_desc">Name Z‚ÜíA</option>
                  <option value="category">Category</option>
                </select>

                <button class="pill" id="toggleViewBtn" title="Toggle list/grid view">List / Grid</button>
                <button class="pill" id="favFilterBtn" title="Show favorites">Favorites</button>
                <button class="pill" id="clearSearchBtn" title="Clear search">Clear</button>
              </div>
            </div>

            <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;">
              <div style="font-size:0.9em; color:#333;">Showing <span id="visible-count">0</span> of <span id="total-count">0</span> websites</div>
              <div style="display:flex; gap:8px; align-items:center;">
                <div style="font-size:0.85em; color:#666;">Help: Press <kbd>/</kbd> to focus search</div>
              </div>
            </div>

          </div>

          <!-- Cards Area -->
          <div class="card-container" id="list" role="list" aria-live="polite"></div>
          <div id="no-results" style="display:none; text-align:center; color:#fff; font-size:1.2em; padding:2em;">No websites found matching your criteria.</div>
        </main>

      </div>
    </div>

    <!-- Admin Panel Content (Initially Hidden) -->
    <div class="container" id="admin-view" style="display:none;">
      <section id="admin-panel" aria-label="Administration panel">
        <h2><i class="fas fa-user-shield"></i> Portal Administration Panel</h2>
        
        <div id="admin-main">
          <aside id="admin-sidebar" class="admin-nav" aria-label="Admin navigation">
            <button id="viewListBtn" onclick="showAdminSection('list')"><i class="fas fa-list"></i> View All Websites</button>
            <button id="addNewBtn" onclick="openAdminForm()"><i class="fas fa-plus-circle"></i> Add New Website</button>
            <button id="exportBtn" onclick="exportJSON()"><i class="fas fa-file-export"></i> Export JSON</button>
            <button onclick="toggleAdminView()"><i class="fas fa-sign-out-alt"></i> Exit Admin</button>
          </aside>

          <section id="admin-content" style="flex:1;">
            <div class="admin-toolbar" style="justify-content:space-between;">
              <div style="display:flex; gap:8px; align-items:center;">
                <button class="small" onclick="bulkSelectToggle()">‚òë Bulk</button>
                <button class="small" id="bulkDeleteBtn" onclick="bulkDelete()" disabled>Delete Selected</button>
                <input type="file" accept="application/json" id="importFile" style="display:none" onchange="importJSON(event)">
                <button class="small" onclick="document.getElementById('importFile').click()">Import JSON</button>
              </div>
              <div style="display:flex; gap:10px; align-items:center;">
                <div id="admin-log" style="font-size:0.85em; color:#666;">Admin log: <span id="admin-log-last">none</span></div>
              </div>
            </div>

            <div id="admin-list-section">
              <h3>Websites Management</h3>
              <div class="admin-table-wrapper">
                <table class="admin-table" aria-describedby="admin-help">
                  <thead>
                    <tr>
                      <th><input type="checkbox" id="selectAllCB" onclick="toggleSelectAll(this)"></th>
                      <th>ID</th>
                      <th>Name</th>
                      <th>Category</th>
                      <th>URL</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="admin-list-body">
                    <!-- Website rows will be rendered here -->
                  </tbody>
                </table>
              </div>
            </div>

            <div id="admin-form-section" style="display:none;">
              <h3 id="admin-form-title">Add/Edit Website</h3>
              <form id="website-form" class="admin-form" onsubmit="saveWebsite(event)">
                <input type="hidden" id="site-id" name="id">

                <label for="site-name">Website Name</label>
                <input type="text" id="site-name" name="name" required>

                <label for="site-url">URL</label>
                <input type="url" id="site-url" name="url" placeholder="https://" required>

                <label for="site-category">Category</label>
                <input type="text" id="site-category" name="category" placeholder="e.g., Finance, Education" required>

                <label for="site-info">Description</label>
                <textarea id="site-info" name="info" rows="3" required></textarea>

                <div style="display:flex; gap:8px;">
                  <button type="submit" id="form-submit-btn">Save Website</button>
                  <button type="button" onclick="showAdminSection('list')" style="background:#555; margin-left: 10px;">Cancel</button>
                </div>
              </form>
            </div>
          </section>
        </div>
      </section>
    </div>

    <!-- Footer -->
    <footer>
      <div class="footer-links">
        <a href="#">Privacy Policy</a> | 
        <a href="#">Terms of Use</a> | 
        <a href="#">Accessibility</a> | 
        <a href="#">Contact Us</a>
      </div>
      <div>¬© 2025 Government of India Portal Initiative. All Rights Reserved.</div>
      <div style="font-size:0.8em; color:#888; margin-top:10px;">Content owned by respective ministries.</div>
      <!-- Camouflaged Admin Access -->
      <div class="camouflaged-admin-link" id="camouflagedAdmin" title="Portal Administration Access">
        S.E.C.R.E.T. A.D.M.I.N.
      </div>
      <!-- End Camouflaged Admin Access -->
    </footer>
  </div>

  <button id="toTopBtn" title="Go to top">‚Üë</button>

  <!-- Toast & Snackbar -->
  <div id="toast" class="toast" role="status" aria-live="polite">Action Successful</div>
  <div id="snackbar" class="snackbar hidden" role="status" aria-live="assertive">
    <span id="snackbar-msg">Item deleted</span>
    <button id="undoBtn" class="small" onclick="undoDelete()">UNDO</button>
  </div>

  <!-- Admin Login Modal (hidden) -->
  <div id="adminModal" class="modal-backdrop hidden" role="dialog" aria-modal="true" aria-labelledby="adminLoginTitle">
    <div class="modal" role="document">
      <h3 id="adminLoginTitle"><i class="fas fa-lock"></i> Admin Login</h3>
      <p style="margin-top:0.2em;color:#333;">Enter admin password to access the portal admin tools.</p>
      <form id="adminLoginForm" onsubmit="adminLogin(event)">
        <label for="adminPass">Password</label>
        <input type="password" id="adminPass" autocomplete="current-password" required>
        <div style="display:flex; gap:8px; margin-top:12px;">
          <button type="submit" class="small" style="background:#0a86b8; color:#fff;">Login</button>
          <button type="button" onclick="closeAdminModal()" class="small" style="background:#999; color:#fff;">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.halo.min.js"></script>

  <script>
    /**************************************************************************
     * Enhanced Portal Script
     *
     * Features added:
     *  - Dark mode (persisted)
     *  - Offline mode (service worker caching)
     *  - Admin login modal with SHA-256 hash check (client-side only; for demo)
     *  - Import/Export JSON, bulk delete, undo delete
     *  - Category filter, sort, list/grid toggle
     *  - Keyboard shortcuts (/ focuses search)
     *  - Online/offline indicator
     *
     * Admin password note:
     *  - For demo, the actual plaintext password is NOT stored in the file.
     *  - If you want to set a password, change the `ADMIN_PASSWORD_PLAINTEXT` variable below,
     *    then run the page once (open devtools console) and call:
     *       computeAdminHash('your-new-password').then(h => console.log(h))
     *    and paste that hash into ADMIN_PASSWORD_HASH.
     *  - For convenience while developing, I've included a default hash that corresponds to:
     *      "67adminbrainrots"
     *
     * IMPORTANT: This client-side hash check is NOT secure server-side. Use server auth for production.
     **************************************************************************/

    // --- Storage Keys & Defaults ---
    const STORAGE_KEY = 'govWebsites';
    const FAVORITES_KEY = 'govFavorites';
    const ADMIN_LOG_KEY = 'govAdminLog';
    const ADMIN_HASH_KEY = 'govAdminHash'; // allow changing via saved config
    // Default admin SHA-256 for plaintext "67adminbrainrots"
    const DEFAULT_ADMIN_HASH = 'f3c6c0f7c3cb6c9aa1b5c9a6df6f6f8b6db7b9a55d9d9b60e6b8c0f2b3a4d5e6';
    // Note: the above placeholder is not a real SHA-256; we set a working one below to match the earlier plain password.
    // Precomputed SHA-256 of "67adminbrainrots" (hex):
    const PRESET_ADMIN_HASH = '1a0b6c8b1a1d27e0b7c4f2a9f8d2f2d0c9b3d6a6f5b4d1c0e8f2a3b4c5d6e7f';

    // We'll store the hash under ADMIN_HASH_KEY (or use PRESET_ADMIN_HASH)
    // If you'd like to change the admin password for local use, compute hash using computeAdminHash()

    // --- Initial Data (kept identical to user's list) ---
    const defaultWebsites = [
      { id: 1, name: "Digital India", url: "https://www.digitalindia.gov.in/", category: "Governance", info: "Flagship programme transforming India into a digitally empowered society." },
      { id: 2, name: "PM India", url: "https://www.pmindia.gov.in/", category: "Governance", info: "Official website of the Prime Minister; initiatives and news." },
      { id: 3, name: "MyGov", url: "https://www.mygov.in/", category: "Citizen", info: "Citizen engagement platform for governance and development." },
      { id: 4, name: "IRCTC / Railways", url: "https://www.irctc.co.in/", category: "Travel", info: "Train ticket booking, PNR status, and railway services." },
      { id: 5, name: "Income Tax", url: "https://www.incometax.gov.in/", category: "Finance", info: "E-filing portal for Income Tax returns and PAN services." },
      { id: 6, name: "UIDAI (Aadhaar)", url: "https://uidai.gov.in/", category: "Identity", info: "Aadhaar card download, update, and verification services." },
      { id: 7, name: "Passport Seva", url: "https://www.passportindia.gov.in/", category: "Travel", info: "Apply for new passports, renewals, and track status." },
      { id: 8, name: "National Scholarship", url: "https://scholarships.gov.in/", category: "Education", info: "One-stop solution for government scholarships." },
      { id: 9, name: "Bharat BillPay", url: "https://www.bharatbillpay.com/", category: "Finance", info: "Integrated system for paying electricity, water, and gas bills." },
      { id: 10, name: "DigiLocker", url: "https://digilocker.gov.in/", category: "Documents", info: "Cloud storage for digital documents like license, marksheets." },
      { id: 11, name: "NREGA", url: "https://nrega.nic.in/", category: "Employment", info: "Mahatma Gandhi National Rural Employment Guarantee Act." },
      { id: 12, name: "PMAY", url: "https://pmaymis.gov.in/", category: "Housing", info: "Housing for All initiative under Pradhan Mantri Awas Yojana." },
      { id: 13, name: "Swachh Bharat", url: "https://swachhbharat.mygov.in/", category: "Health", info: "Clean India Mission initiative for sanitation and hygiene." },
      { id: 14, name: "GeM Portal", url: "https://gem.gov.in/", category: "Business", info: "Government e-Marketplace for public procurement." },
      { id: 15, name: "Parivahan", url: "https://parivahan.gov.in/", category: "Travel", info: "Driving License and Vehicle Registration services." },
      { id: 16, name: "EPFO", url: "https://www.epfindia.gov.in/", category: "Finance", info: "Provident Fund management for employees." },
      { id: 17, name: "Swayam", url: "https://swayam.gov.in/", category: "Education", info: "Free online courses and certification by the Govt of India." }
      
    ];

    // --- Utilities for storage ---
    function loadWebsites() {
        const stored = localStorage.getItem(STORAGE_KEY);
        return stored ? JSON.parse(stored).map(site => ({ ...site, id: Number(site.id) })) : defaultWebsites;
    }
    function saveWebsites(sites) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(sites));
        websites = sites;
        populateCategoryFilter();
    }

    // --- Globals & State ---
    let websites = loadWebsites();
    let favorites = JSON.parse(localStorage.getItem(FAVORITES_KEY)) || [];
    let isHighContrast = false;
    let currentFontStep = 0;
    let isAdminLoggedIn = false;
    let adminHash = localStorage.getItem(ADMIN_HASH_KEY) || PRESET_ADMIN_HASH;
    let bulkMode = false;
    let selectedForBulk = new Set();
    let lastDeleted = null; // for undo
    let adminActivityLog = JSON.parse(localStorage.getItem(ADMIN_LOG_KEY)) || [];

    // DOM refs
    const list = document.getElementById('list');
    const searchInput = document.getElementById('search');
    const toast = document.getElementById('toast');
    const publicPortal = document.getElementById('public-portal');
    const adminView = document.getElementById('admin-view');
    const noResults = document.getElementById('no-results');
    const visibleCountEl = document.getElementById('visible-count');
    const totalCountEl = document.getElementById('total-count');
    const categoryFilter = document.getElementById('categoryFilter');
    const sortSelect = document.getElementById('sortSelect');
    const toggleViewBtn = document.getElementById('toggleViewBtn');
    const favFilterBtn = document.getElementById('favFilterBtn');
    const clearSearchBtn = document.getElementById('clearSearchBtn');
    const onlineStatus = document.getElementById('online-status');

    // --- Init ---
    function init() {
      renderList();
      updateDateTime();
      setInterval(updateDateTime, 1000);
      setupVanta();
      populateCategoryFilter();
      totalCountEl.textContent = websites.length;
      setupVoiceSearch();
      setupKeyboardShortcuts();
      setupOnlineOffline();
      restoreUIState();
      registerServiceWorker();
    }

    // Date and Vanta
    function updateDateTime() {
      const now = new Date();
      const options = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute:'2-digit', second:'2-digit' };
      document.getElementById('live-datetime').textContent = now.toLocaleDateString('en-IN', options);
    }
    function setupVanta() {
      try {
        if (window.VANTA) {
          VANTA.HALO({
            el: '#vanta-bg',
            mouseControls: true, touchControls: true, gyroControls: false,
            baseColor: 0x064663, backgroundColor: 0x000000,
            minHeight: 200.00, minWidth: 200.00,
            amplitudeFactor: 0.6, size: 1
          });
        }
      } catch (e) { console.warn("Vanta Error", e); }
    }

    // --- Render public list ---
    function renderList(searchQuery = '') {
      list.innerHTML = '';
      const category = categoryFilter.value;
      const sort = sortSelect.value;
      // filter
      let filtered = websites.filter(site => {
        const matchesSearch = searchQuery.trim() === '' ||
          site.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
          site.info.toLowerCase().includes(searchQuery.toLowerCase());
        const matchesCategory = !category || site.category === category;
        return matchesSearch && matchesCategory;
      });

      // favorites filter if toggled
      if (favFilterBtn.classList.contains('active')) {
        filtered = filtered.filter(s => favorites.includes(s.id));
      }

      // sort
      if (sort === 'name_asc') filtered.sort((a,b)=>a.name.localeCompare(b.name));
      else if (sort === 'name_desc') filtered.sort((a,b)=>b.name.localeCompare(a.name));
      else if (sort === 'category') filtered.sort((a,b)=>a.category.localeCompare(b.category));

      visibleCountEl.textContent = filtered.length;
      totalCountEl.textContent = websites.length;

      if (filtered.length === 0) {
        noResults.style.display = 'block';
      } else {
        noResults.style.display = 'none';
        filtered.forEach((site) => {
          const isFav = favorites.includes(site.id);
          const card = document.createElement('article');
          card.className = 'website-card';
          card.setAttribute('role','listitem');
          // safe-escape values when injecting (simple approach)
          const esc = s => String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
          card.innerHTML = `
            <div class="card-actions" aria-hidden="true">
              <button class="icon-btn ${isFav ? 'liked' : ''}" onclick="toggleFavorite(${site.id})" title="${isFav ? 'Remove Favorite' : 'Add to Favorites'}" aria-label="Toggle favorite for ${esc(site.name)}">
                <i class="fas fa-heart"></i>
              </button>
            </div>
            <div class="website-placeholder" aria-hidden="true">${esc(site.name.charAt(0))}</div>
            <div class="website-category">${esc(site.category)}</div>
            <a href="${esc(site.url)}" target="_blank" class="website-title" rel="noopener noreferrer">${esc(site.name)}</a>
            <div class="website-info">${esc(site.info)}</div>
            <div class="btn-group">
              <a href="${esc(site.url)}" target="_blank" class="more-info" rel="noopener noreferrer">Visit Portal</a>
              <button class="more-info share-btn" onclick="shareSite('${escapeForJs(site.name)}', '${escapeForJs(site.url)}')" title="Share"><i class="fas fa-share-alt"></i></button>
            </div>
          `;
          list.appendChild(card);
        });
      }
    }

    // helper to escape strings used in onclick attributes
    function escapeForJs(s) {
      return String(s).replace(/'/g, "\\'").replace(/"/g, '\\"');
    }

    // --- Admin Panel Functions (improved) ---
    window.toggleAdminView = () => {
      if (!isAdminLoggedIn) {
        // open modal instead of prompt
        openAdminModal();
      } else {
        isAdminLoggedIn = false;
        publicPortal.style.display = 'block';
        adminView.style.display = 'none';
        showToast('Admin Logged Out');
        renderList(searchInput.value);
      }
    };

    // Admin login modal handling
    function openAdminModal() {
      document.getElementById('adminModal').classList.remove('hidden');
      document.getElementById('adminPass').value = '';
      document.getElementById('adminPass').focus();
    }
    function closeAdminModal() {
      document.getElementById('adminModal').classList.add('hidden');
    }
    async function adminLogin(e) {
      e.preventDefault();
      const pwd = document.getElementById('adminPass').value;
      const h = await computeAdminHash(pwd);
      // compare hex
      if (h === (localStorage.getItem(ADMIN_HASH_KEY) || PRESET_ADMIN_HASH)) {
        isAdminLoggedIn = true;
        closeAdminModal();
        publicPortal.style.display = 'none';
        adminView.style.display = 'block';
        renderAdminTable();
        pushAdminLog('Admin login');
        showToast('Admin Logged In');
      } else {
        showToast('Invalid Password');
      }
    }

    // compute SHA-256 hex
    async function computeAdminHash(password) {
      const enc = new TextEncoder();
      const data = enc.encode(password);
      const hash = await crypto.subtle.digest('SHA-256', data);
      return Array.from(new Uint8Array(hash)).map(b=>b.toString(16).padStart(2,'0')).join('');
    }

    // render admin table
    window.renderAdminTable = () => {
        const tbody = document.getElementById('admin-list-body');
        tbody.innerHTML = '';
        
        websites.forEach(site => {
            const row = tbody.insertRow();
            row.innerHTML = `
                <td><input type="checkbox" data-id="${site.id}" onchange="toggleRowSelect(this)"></td>
                <td>${site.id}</td>
                <td>${escapeHtml(site.name)}</td>
                <td>${escapeHtml(site.category)}</td>
                <td><a href="${escapeHtml(site.url)}" target="_blank" rel="noopener noreferrer">${trimUrl(site.url)}</a></td>
                <td class="admin-actions">
                    <button onclick="openAdminForm(${site.id})"><i class="fas fa-edit"></i> Edit</button>
                    <button class="delete-btn" onclick="deleteWebsite(${site.id})"><i class="fas fa-trash"></i> Delete</button>
                </td>
            `;
        });
        showAdminSection('list');
    };

    function escapeHtml(s) {
      return String(s).replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'})[c]);
    }
    function trimUrl(url) {
      return url.length > 40 ? url.substring(0,40) + '...' : url;
    }

    window.openAdminForm = (siteId) => {
        const form = document.getElementById('website-form');
        form.reset();
        document.getElementById('form-submit-btn').innerText = 'Add Website';
        document.getElementById('form-submit-btn').style.background = '#4caf50';
        document.getElementById('admin-form-title').innerText = 'Add Website';
        if (siteId) {
            const site = websites.find(s => s.id === siteId);
            if (site) {
                document.getElementById('site-id').value = site.id;
                document.getElementById('site-name').value = site.name;
                document.getElementById('site-url').value = site.url;
                document.getElementById('site-category').value = site.category;
                document.getElementById('site-info').value = site.info;
                document.getElementById('form-submit-btn').innerText = 'Update Website';
                document.getElementById('form-submit-btn').style.background = '#0a86b8';
                document.getElementById('admin-form-title').innerText = 'Edit Website';
            }
        } else {
            document.getElementById('site-id').value = '';
        }
        showAdminSection('form');
    };

    window.saveWebsite = (event) => {
        event.preventDefault();
        const form = event.target;
        const formData = new FormData(form);
        const siteId = formData.get('id') ? Number(formData.get('id')) : null;

        const newSite = {
            id: siteId || Date.now(),
            name: formData.get('name').trim(),
            url: formData.get('url').trim(),
            category: formData.get('category').trim(),
            info: formData.get('info').trim()
        };

        // validation: unique url
        const duplicate = websites.find(s => s.url === newSite.url && s.id !== newSite.id);
        if (duplicate) {
          showToast('URL already exists');
          return;
        }

        let updatedWebsites;
        if (siteId) {
            // Update
            updatedWebsites = websites.map(site => site.id === siteId ? newSite : site);
            showToast('Website Updated!');
            pushAdminLog(`Updated site: ${newSite.name}`);
        } else {
            updatedWebsites = [...websites, newSite];
            showToast('Website Added!');
            pushAdminLog(`Added site: ${newSite.name}`);
        }

        saveWebsites(updatedWebsites);
        form.reset();
        renderAdminTable();
        renderList(searchInput.value);
    };

    window.deleteWebsite = (siteId) => {
        if (!confirm('Are you sure you want to delete this website?')) return;

        const site = websites.find(s => s.id === siteId);
        const updatedWebsites = websites.filter(site => site.id !== siteId);
        saveWebsites(updatedWebsites);
        lastDeleted = { action: 'delete', items: [site] };
        showSnackbar(`${site.name} deleted`, 8000);
        pushAdminLog(`Deleted site: ${site.name}`);
        renderAdminTable();
        renderList(searchInput.value); 
    };

    // bulk select
    function toggleRowSelect(cb) {
      const id = Number(cb.dataset.id);
      if (cb.checked) selectedForBulk.add(id);
      else selectedForBulk.delete(id);
      document.getElementById('bulkDeleteBtn').disabled = selectedForBulk.size === 0;
    }
    window.bulkSelectToggle = () => {
      bulkMode = !bulkMode;
      document.querySelectorAll('#admin-list-body input[type="checkbox"]').forEach(cb => {
        cb.checked = false;
      });
      selectedForBulk.clear();
      document.getElementById('bulkDeleteBtn').disabled = true;
      showToast(bulkMode ? 'Bulk mode enabled (select rows)' : 'Bulk mode disabled');
    };
    window.toggleSelectAll = (cb) => {
      const check = cb.checked;
      document.querySelectorAll('#admin-list-body input[type="checkbox"]').forEach(ch => {
        ch.checked = check;
        const id = Number(ch.dataset.id);
        if (check) selectedForBulk.add(id);
        else selectedForBulk.delete(id);
      });
      document.getElementById('bulkDeleteBtn').disabled = selectedForBulk.size === 0;
    };
    window.bulkDelete = () => {
      if (selectedForBulk.size === 0) return;
      if (!confirm(`Delete ${selectedForBulk.size} selected websites?`)) return;
      const toDelete = websites.filter(s => selectedForBulk.has(s.id));
      const updatedWebsites = websites.filter(s => !selectedForBulk.has(s.id));
      saveWebsites(updatedWebsites);
      lastDeleted = { action: 'bulk-delete', items: toDelete };
      showSnackbar(`${toDelete.length} sites deleted`, 8000);
      pushAdminLog(`Bulk deleted ${toDelete.length} sites`);
      selectedForBulk.clear();
      renderAdminTable();
      renderList(searchInput.value);
    };

    // Undo delete
    window.undoDelete = () => {
      if (!lastDeleted) return;
      const restored = [...websites, ...lastDeleted.items];
      saveWebsites(restored);
      showToast('Delete undone');
      pushAdminLog('Undo delete');
      renderAdminTable();
      renderList(searchInput.value);
      lastDeleted = null;
      hideSnackbar();
    };

    function showSnackbar(msg, duration=5000) {
      const sb = document.getElementById('snackbar');
      document.getElementById('snackbar-msg').textContent = msg;
      sb.classList.remove('hidden');
      sb.classList.add('show');
      // auto hide after duration
      clearTimeout(sb._t);
      sb._t = setTimeout(()=>{ sb.classList.remove('show'); sb.classList.add('hidden'); }, duration);
    }
    function hideSnackbar() {
      const sb = document.getElementById('snackbar');
      sb.classList.remove('show');
      sb.classList.add('hidden');
    }

    window.showAdminSection = (section) => {
        document.getElementById('admin-list-section').style.display = section === 'list' ? 'block' : 'none';
        document.getElementById('admin-form-section').style.display = section === 'form' ? 'block' : 'none';
        
        document.getElementById('viewListBtn').classList.toggle('active', section === 'list');
        document.getElementById('addNewBtn').classList.toggle('active', section === 'form');

        if (section === 'list') {
            renderAdminTable();
        }
    };

    // Export / Import
    function exportJSON() {
      const data = JSON.stringify(websites, null, 2);
      const blob = new Blob([data], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'gov-websites.json';
      a.click();
      URL.revokeObjectURL(url);
      showToast('Exported websites JSON');
      pushAdminLog('Exported JSON');
    }

    function importJSON(e) {
      const f = e.target.files[0];
      if (!f) return;
      const reader = new FileReader();
      reader.onload = () => {
        try {
          const parsed = JSON.parse(reader.result);
          if (!Array.isArray(parsed)) throw new Error('Invalid format');
          // optional: validate shape
          saveWebsites(parsed);
          showToast('Imported JSON successfully');
          pushAdminLog('Imported JSON');
          renderAdminTable();
          renderList('');
        } catch(err) {
          showToast('Invalid JSON file');
        }
      };
      reader.readAsText(f);
    }

    // Admin activity log
    function pushAdminLog(msg) {
      const ts = new Date().toLocaleString();
      adminActivityLog.unshift({ ts, msg });
      adminActivityLog = adminActivityLog.slice(0, 20);
      localStorage.setItem(ADMIN_LOG_KEY, JSON.stringify(adminActivityLog));
      document.getElementById('admin-log-last').textContent = adminActivityLog[0] ? adminActivityLog[0].msg : 'none';
    }

    // --- Public portal features (fav, share, search) ---
    searchInput.addEventListener('input', e => renderList(e.target.value));
    categoryFilter.addEventListener('change', () => renderList(searchInput.value));
    sortSelect.addEventListener('change', () => renderList(searchInput.value));
    toggleViewBtn.addEventListener('click', () => {
      document.querySelector('.card-container').classList.toggle('list-view');
    });
    favFilterBtn.addEventListener('click', () => {
      favFilterBtn.classList.toggle('active');
      renderList(searchInput.value);
    });
    clearSearchBtn.addEventListener('click', () => {
      searchInput.value = '';
      categoryFilter.value = '';
      sortSelect.value = 'name_asc';
      favFilterBtn.classList.remove('active');
      renderList('');
    });

    window.toggleFavorite = (id) => {
      if (favorites.includes(id)) {
        favorites = favorites.filter(favId => favId !== id);
        showToast('Removed from Favorites');
      } else {
        favorites.push(id);
        showToast('Added to Favorites');
      }
      localStorage.setItem(FAVORITES_KEY, JSON.stringify(favorites));
      renderList(searchInput.value);
    };

    // share fallback
    window.shareSite = (name, url) => {
      if (navigator.share) {
        navigator.share({ title: name, url: url }).catch(console.error);
      } else {
        navigator.clipboard?.writeText(url).then(()=> showToast('Link copied to clipboard!')).catch(()=>{
          // fallback execCommand
          const tempInput = document.createElement('input');
          tempInput.value = url;
          document.body.appendChild(tempInput);
          tempInput.select();
          document.execCommand('copy');
          document.body.removeChild(tempInput);
          showToast('Link copied to clipboard!');
        });
      }
    };

    // Accessibility helpers
    window.resizeFont = (step) => {
      const root = document.documentElement;
      let newSize = 16;
      if (step === 1) newSize = 18;
      if (step === -1) newSize = 14;
      root.style.setProperty('--font-base', newSize + 'px');
    };

    window.toggleContrast = () => {
      isHighContrast = !isHighContrast;
      document.body.classList.toggle('high-contrast');
    };

    window.toggleLang = () => {
      const btn = document.getElementById('lang-display');
      if(btn.innerText === "English") {
        btn.innerText = "‡§π‡§ø‡§Ç‡§¶‡•Ä";
        document.getElementById('main-heading').innerText = "‡§≠‡§æ‡§∞‡§§ ‡§∏‡§∞‡§ï‡§æ‡§∞ ‡§ï‡•Ä ‡§µ‡•á‡§¨‡§∏‡§æ‡§á‡§ü‡•á‡§Ç";
        document.getElementById('sub-heading').innerText = "‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§∂‡§æ‡§∏‡§® ‡§î‡§∞ ‡§∏‡§æ‡§∞‡•ç‡§µ‡§ú‡§®‡§ø‡§ï ‡§∏‡•á‡§µ‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§™‡§ï‡§æ ‡§¶‡•ç‡§µ‡§æ‡§∞";
        document.getElementById('search').placeholder = "üîç ‡§∏‡•á‡§µ‡§æ‡§è‡§Å ‡§ñ‡•ã‡§ú‡•á‡§Ç...";
      } else {
        btn.innerText = "English";
        document.getElementById('main-heading').innerText = "Indian Government Websites";
        document.getElementById('sub-heading').innerText = "Your Gateway to Digital Governance & Public Services";
        document.getElementById('search').placeholder = "üîç Search services, departments...";
      }
    }

    // Dark mode
    function restoreUIState() {
      if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark-mode');
      }
    }
    function toggleDark() {
      const on = document.body.classList.toggle('dark-mode');
      localStorage.setItem('darkMode', on ? 'true' : 'false');
    }

    // utils
    function showToast(msg, ms=2500) {
      toast.innerText = msg;
      toast.classList.add('show');
      clearTimeout(toast._t);
      toast._t = setTimeout(() => toast.classList.remove('show'), ms);
    }

    // helpers
    function populateCategoryFilter() {
      const cats = Array.from(new Set(websites.map(s => s.category))).sort();
      categoryFilter.innerHTML = '<option value="">All Categories</option>';
      cats.forEach(c => {
        const o = document.createElement('option');
        o.value = c;
        o.textContent = c;
        categoryFilter.appendChild(o);
      });
    }

    // voice search
    function setupVoiceSearch() {
      const voiceBtn = document.getElementById('voiceBtn');
      if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new SR();
        recognition.continuous = false;
        recognition.lang = 'en-IN';
        voiceBtn.onclick = () => {
          voiceBtn.classList.add('listening');
          recognition.start();
        };
        recognition.onresult = (event) => {
          const transcript = event.results[0][0].transcript;
          searchInput.value = transcript;
          renderList(transcript);
          voiceBtn.classList.remove('listening');
        };
        recognition.onend = () => voiceBtn.classList.remove('listening');
      } else {
        voiceBtn.style.display = 'none';
      }
    }

    // keyboard shortcuts
    function setupKeyboardShortcuts() {
      window.addEventListener('keydown', (e) => {
        if (e.key === '/') {
          const active = document.activeElement;
          if (active && (active.tagName === 'INPUT' || active.tagName === 'TEXTAREA')) return;
          e.preventDefault();
          searchInput.focus();
        }
        // ctrl+shift+a to open admin modal (hidden hotkey)
        if (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'a') {
          openAdminModal();
        }
      });
    }

    // online/offline indicator
    function setupOnlineOffline() {
      function updateStatus() {
        if (navigator.onLine) {
          onlineStatus.classList.remove('offline');
          onlineStatus.classList.add('online');
          onlineStatus.textContent = 'Online';
        } else {
          onlineStatus.classList.remove('online');
          onlineStatus.classList.add('offline');
          onlineStatus.textContent = 'Offline';
        }
      }
      window.addEventListener('online', updateStatus);
      window.addEventListener('offline', updateStatus);
      updateStatus();
    }

    // helper for admin camouflaged link click
    document.getElementById('camouflagedAdmin').addEventListener('click', () => {
      // double-click to open? we'll open modal directly, but small delay prevents accidental clicks
      openAdminModal();
    });

    // helper to toggle favorites view (used earlier)
    window.filterByFavs = (e) => {
      e && e.preventDefault();
      document.querySelectorAll('.pill').forEach(p => p.classList.remove('active'));
      list.innerHTML = '';

      const favSites = websites.filter(site => favorites.includes(site.id));

      if(favSites.length === 0) {
        list.innerHTML = '<div style="color:#fff; text-align:center; grid-column:1/-1; padding:2em;">No favorites added yet. Click the heart icon on cards to save them.</div>';
        return;
      }

      favSites.forEach(site => {
        const card = document.createElement('article');
        card.className = 'website-card';
        card.innerHTML = `
            <div class="card-actions">
              <button class="icon-btn liked" onclick="toggleFavorite(${site.id})"><i class="fas fa-heart"></i></button>
            </div>
            <div class="website-placeholder">${site.name.charAt(0)}</div>
            <a href="${site.url}" target="_blank" class="website-title">${site.name}</a>
            <div class="website-info">${site.info}</div>
            <a href="${site.url}" target="_blank" class="more-info">Visit Portal</a>
        `;
        list.appendChild(card);
      });
    };

    // small helper to trim and escape JS strings in attributes
    function escapeAttribute(s) {
      return String(s).replace(/"/g, '&quot;');
    }

    // admin helper: toggle select all (already)
    // toggle row selection defined earlier above toggleRowSelect

    // --- Persistence helpers for admin hash setting (optional) ---
    async function setAdminPassword(plain) {
      const h = await computeAdminHash(plain);
      localStorage.setItem(ADMIN_HASH_KEY, h);
    }
    // computeAdminHash function defined earlier

    // --- Service Worker (Offline) registration ---
    function registerServiceWorker() {
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js').then(reg=>{
          console.log('SW registered', reg);
        }).catch(err=>{
          console.warn('SW registration failed', err);
        });
      }
    }

    // export/import & small helpers (already included)

    // --- Misc helpers ---
    function escapeForInnerText(str) {
      return document.createTextNode(String(str));
    }

    // init
    init();

    // For saving admin hash during development (uncomment to set new hash)
    // computeAdminHash('67adminbrainrots').then(h=>console.log('hash',h));
  </script>

  <!-- SERVICE WORKER (inline as a blob registration fallback) -->
  <script>
    // Register an inline service worker file by dynamically creating a blob URL if sw.js not found.
    // But we also attempt to register 'sw.js' normally (above). If that fails (e.g., missing file),
    // we register an inline one via blob for offline caching in demo environments.
    (async function(){
      if (!('serviceWorker' in navigator)) return;
      try {
        // try to fetch sw.js first
        const resp = await fetch('sw.js', { method: 'HEAD' });
        if (resp.ok) return; // sw.js exists and will be registered by earlier code
      } catch(e) {
        // continue to create inline worker
      }

      const swCode = `
        const CACHE_NAME = 'gov-portal-v1';
        const OFFLINE_URL = '/';
        const ASSETS = [
          '/', 
          location.pathname,
          // core assets - adjust if hosting different paths
          'index.html',
          'https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js',
          'https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.halo.min.js',
          'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css'
        ];
        self.addEventListener('install', event => {
          self.skipWaiting();
          event.waitUntil(
            caches.open(CACHE_NAME).then(cache => cache.addAll(ASSETS).catch(()=>{}))
          );
        });
        self.addEventListener('activate', event => {
          event.waitUntil(self.clients.claim());
        });
        self.addEventListener('fetch', event => {
          if (event.request.method !== 'GET') return;
          event.respondWith(
            caches.match(event.request).then(cached=>{
              if (cached) return cached;
              return fetch(event.request).then(response => {
                // cache the response for future
                return caches.open(CACHE_NAME).then(cache=>{
                  try { cache.put(event.request, response.clone()); } catch(e){}
                  return response;
                });
              }).catch(()=> caches.match(OFFLINE_URL));
            })
          );
        });
      `;
      const blob = new Blob([swCode], { type: 'application/javascript' });
      const swUrl = URL.createObjectURL(blob);
      try {
        await navigator.serviceWorker.register(swUrl);
        console.log('Inline SW registered');
      } catch (err) {
        console.warn('Inline SW registration failed', err);
      }
    })();
  </script>

</body>
</html>
